#!/bin/sh
tput setaf 1 > /dev/null 2>&1
if [ $? -eq 0 ]
then
  tp=tput
else
  tp=/bin/true
fi

black=$($tp setaf 0)
red=$($tp setaf 1)
green=$($tp setaf 2)
yellow=$($tp setaf 3)
blue=$($tp setaf 4)
magenta=$($tp setaf 5)
cyan=$($tp setaf 6)
white=$($tp setaf 7)
normal=$($tp sgr0)/

picom_toggle_rounded_borders () {
  if grep -q "# corner-radius" "$XDG_CONFIG_HOME/picom.conf"; then
    sed -i '/^# corner-radius/ s/# //' "$XDG_CONFIG_HOME/picom.conf"
    echo "${green}Turning on${normal} rounded corners"
  else
    sed -i '/^corner-radius/ s/./# &/' "$XDG_CONFIG_HOME/picom.conf"
    echo "${red}Turning off${normal} rounded corners"
  fi
}

picom_toggle () {
  pidof -q picom && killall picom || picom &
}

set_theme () {
  # ARGS: THEME_TO_ADD THEME_TO_REMOVE COMMENT_STRING FILE
  grep_and_sed_file () {
    # Check if the theme its trying to switch to is inactive and if it isn't throw error
    if grep -q "^$3.*SED_$1" $4; then
      sed -i "/SED_$1/ s/$3 //" $4
    else
      echo "${red}atempted to enable an active${normal} ($1 is currently active in $4)"
    fi

    # Check if the theme its trying to switch from is inactive and if it is throw error
    if grep -q "^$3.*SED_$2" $4; then
      echo "${red}atempted to disable an inactive theme${normal} ($2 is disabled in $4)"
    else
      sed -i "/SED_$2/ s/./$3 &/" $4
    fi
  }

  grep_and_sed_file $1 $2 "--" ~/.config/nvim/lua/rice/init.lua # nvim
  grep_and_sed_file $1 $2 "--" ~/.config/xmobar/xmobarrc0 # xmobar right side and bg
  grep_and_sed_file $1 $2 "#" ~/.config/alacritty/alacritty.yml # alacritty
  grep_and_sed_file $1 $2 "#" ~/.tmux.conf && tmux source-file ~/.tmux.conf # tmux
  grep_and_sed_file $1 $2 "--" ~/.xmonad/xmonad.hs && xmonad --recompile && xmonad --restart # xmonad borders and xmobar left side

  nitrogen --save --set-zoom-fill ~/.config/assets/wppr/$1.png # wallpaper

  # deadd-notification-center
  cat ~/.config/deadd/$1.txt > ~/.config/deadd/deadd.css && \
    killall deadd-notification-center && \
    deadd-notification-center & disown

  sed -i "/$2/ s/$2/$1/" ~/.config/rofi/themes/colorschemes/colors.rasi # rofi

  # GTK-3
  sed -i "/gtk-theme-name=$2/ s/gtk-theme-name=$2/gtk-theme-name=$1/" ~/.config/gtk-3.0/settings.ini
  sed -i "/gtk-icon-theme-name=$2/ s/gtk-icon-theme-name=$2/gtk-icon-theme-name=$1/" ~/.config/gtk-3.0/settings.ini
  sed -i "/gtk-cursor-theme-name=$2/ s/gtk-cursor-theme-name=$2/gtk-cursor-theme-name=$1/" ~/.config/gtk-3.0/settings.ini
  # GTK-2
  sed -i "/gtk-theme-name=$2/ s/gtk-theme-name=$2/gtk-theme-name=$1/" ~/.gtkrc-2.0
  sed -i "/gtk-icon-theme-name=$2/ s/gtk-icon-theme-name=$2/gtk-icon-theme-name=$1/" ~/.gtkrc-2.0
  sed -i "/gtk-cursor-theme-name=$2/ s/gtk-cursor-theme-name=$2/gtk-cursor-theme-name=$1/" ~/.gtkrc-2.0
}

while [ ! $# -eq 0 ]
do
	case "$1" in
		--toggle-rounded-corners)
        picom_toggle_rounded_borders
			exit
			;;
		--toggle-picom)
        picom_toggle
			exit
			;;
    --set-theme-dracula)
        set_theme DRACULA GRUVBOX
      exit
      ;;
    --set-theme-gruvbox)
        set_theme GRUVBOX DRACULA
      exit
      ;;
    -h|--help)
      echo "rice-ctrl [--toggle-rounded-corners]"
	esac
	shift
done
